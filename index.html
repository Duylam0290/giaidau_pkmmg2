<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giải đấu Solo PK Pokémon Mega 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #0f172a; /* slate-900 */
            color: #f8fafc; /* slate-50 */
        }
        .match {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background-color: #1e293b; /* slate-800 */
            border: 1px solid #334155; /* slate-700 */
            border-radius: 0.25rem;
            width: 200px;
            min-height: 60px;
            padding: 5px;
            margin: 20px 0;
        }
        .player {
            padding: 5px;
            display: flex;
            justify-content: space-between;
        }
        .winner {
            font-weight: bold;
            color: #22c55e; /* green-500 */
        }
        .round {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            margin-right: 50px;
        }
        .bracket {
            display: flex;
            overflow-x: auto;
            padding: 20px;
        }
        .connector {
            position: absolute;
            top: 50%;
            left: 100%;
            width: 25px;
            height: 1px;
            background-color: #475569; /* slate-600 */
        }
        .connector-end {
            position: absolute;
            left: 25px;
            top: 0;
            height: 100%;
            width: 1px;
            background-color: #475569; /* slate-600 */
        }
        .match-container {
             position: relative;
        }
    </style>
</head>
<body class="antialiased font-sans">
    <header class="flex justify-between items-center p-4 border-b border-slate-700">
        <h1 class="text-2xl font-bold tracking-wider text-sky-400">Giải đấu Solo PK Pokémon Mega 2</h1>
    </header>

    <main id="main-content" class="p-4">
        <div id="message-area" class="text-center text-lg"></div>
        <div id="bracket" class="bracket"></div>
    </main>
    
    <script>
        const PUBLIC_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzVaRsH6cqftBwF9564r-YHXTB86wb-W-eFNRWjPsbAskHvzRUSHy3EJDnqenTYPzk/exec';

        const bracketContainer = document.getElementById('bracket');
        const messageArea = document.getElementById('message-area');

        function showMessage(text, isError = false) {
            messageArea.textContent = text;
            messageArea.className = isError ? 'text-center text-lg text-red-500' : 'text-center text-lg text-slate-400';
        }
        
        async function fetchTournamentData() {
            if (!PUBLIC_SCRIPT_URL || PUBLIC_SCRIPT_URL === 'https://script.google.com/macros/s/AKfycbzVaRsH6cqftBwF9564r-YHXTB86wb-W-eFNRWjPsbAskHvzRUSHy3EJDnqenTYPzk/exec') {
                showMessage('Chưa có dữ liệu', true);
                return;
            }
            showMessage('Loading tournament data...');
            try {
                const response = await fetch(PUBLIC_SCRIPT_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                renderBracket(data);
                messageArea.textContent = '';
            } catch (error) {
                console.error('Error fetching data:', error);
                showMessage('Could not load tournament data. Is the script URL correct and deployed?', true);
            }
        }

        function renderBracket(data) {
            bracketContainer.innerHTML = '';
            if (!data || data.length === 0) {
                showMessage('No tournament data found.');
                return;
            }

            const rounds = {};
            data.forEach(match => {
                if (!rounds[match.Round]) {
                    rounds[match.Round] = [];
                }
                rounds[match.Round].push(match);
            });

            Object.keys(rounds).sort((a,b) => a-b).forEach(roundNum => {
                const roundDiv = document.createElement('div');
                roundDiv.className = 'round';
                roundDiv.dataset.round = roundNum;

                rounds[roundNum].sort((a,b) => a.Match - b.Match).forEach(matchData => {
                    const matchContainer = document.createElement('div');
                    matchContainer.className = 'match-container';
                    
                    const matchDiv = document.createElement('div');
                    matchDiv.className = 'match';
                    matchDiv.dataset.round = matchData.Round;
                    matchDiv.dataset.match = matchData.Match;

                    const player1Div = createPlayerDiv(matchData.Player1, matchData.Winner);
                    const player2Div = createPlayerDiv(matchData.Player2, matchData.Winner);
                    
                    matchDiv.appendChild(player1Div);
                    matchDiv.appendChild(player2Div);

                    const nextRoundExists = rounds[parseInt(roundNum) + 1];
                    if (nextRoundExists) {
                        const connector = document.createElement('div');
                        connector.className = 'connector';
                        const connectorEnd = document.createElement('div');
                        connectorEnd.className = 'connector-end';
                        connector.appendChild(connectorEnd);
                        matchContainer.appendChild(connector);
                    }
                    
                    matchContainer.prepend(matchDiv);
                    roundDiv.appendChild(matchContainer);
                });
                bracketContainer.appendChild(roundDiv);
            });
        }
        
        function createPlayerDiv(playerName, winner) {
            const playerDiv = document.createElement('div');
            playerDiv.className = 'player';
            playerDiv.textContent = playerName || 'TBD';
            if (playerName && playerName === winner) {
                playerDiv.classList.add('winner');
            }
            return playerDiv;
        }

        // Initial load
        document.addEventListener('DOMContentLoaded', fetchTournamentData);
    </script>
</body>
</html>
